import{j as e,q as E,r as i,n as h,y as I}from"./app-iOfuzUGb.js";import{u as B,t as V,F as M,a as g,b as N,c as w,d as D,e as k,f as R}from"./index-Cyog8zbY.js";import{c as b}from"./utils-CytzSlOG.js";import{P as T,a as z,b as _,g as G,C as O,c as H,d as K,e as q,f as A}from"./popover-5xWleg_i.js";import{B as v}from"./button-CBBp6SUM.js";import{I as y}from"./input-4Ecyl3lW.js";import{F as U}from"./schema-M9b85mzh.js";import W from"./MyMap-C47uQ329.js";import{D as J,a as Q,b as X,c as Y,d as Z,e as $,f as ee,g as se}from"./dialog-DrqQCznL.js";import{C as ae}from"./chevrons-up-down-CfYBEtIL.js";import{C as te}from"./index-BYqmRzxH.js";import"./index-AB4lCN4f.js";import"./label-DbXf6KDD.js";import"./index-QihyCi18.js";import"./index-BwobEAja.js";import"./component-pbkn7HhS.js";import"./index-tqG9kcKA.js";import"./search-CaOL-efN.js";import"./createLucideIcon-DGLUHFW_.js";import"./floating-ui.react-dom-DLcBhIi8.js";import"./leaflet-OwergAD_.js";import"./index-Dg1d9P5o.js";function Se({complaints:l,items:r}){return e.jsx(e.Fragment,{children:e.jsxs(J,{children:[e.jsx(Q,{asChild:!0,children:e.jsx(v,{variant:"outline",children:"Edit Profile"})}),e.jsxs(X,{className:"sm:max-w-[50rem]",onInteractOutside:o=>{o.preventDefault()},children:[e.jsxs(Y,{className:"mb-2",children:[e.jsx(Z,{children:"Buat Data Perbaikan"}),e.jsx($,{children:"Deskripsi"})]}),e.jsx("div",{className:"space-y-5 overflow-y-auto h-[70vh] rounded-scrollbar","data-lenis-prevent":!0,children:e.jsx("div",{className:"pr-5 pb-5",children:e.jsx(re,{items:r,complaints:l})})}),e.jsxs(ee,{children:[e.jsx(se,{asChild:!0,children:e.jsx(v,{type:"button",variant:"secondary",children:"Close"})}),e.jsx(v,{type:"submit",form:"form-repair",children:"Save changes"})]})]})]})})}function re({className:l,complaints:r,items:o}){E().props;const s=B({resolver:V(U),defaultValues:{item_id:"",complaint_id:"",latitude:"",longitude:"",note:""},mode:"onBlur"});function c(){I.post(route("repair.store"),s.getValues(),{onSuccess:()=>{h.success("Success!"),s.reset()},onError:()=>{h.error("Terjadi Kesalahan!")}})}const d=t=>{s.setValue("latitude",t.lat),s.setValue("longitude",t.lng)},[C,x]=i.useState(null),j=["Belum diproses","Sedang diproses"],f=r.filter(t=>j.includes(t.statuses.status));return e.jsx(M,{...s,children:e.jsxs("form",{onSubmit:s.handleSubmit(c),encType:"multipart/form-data",className:b("space-y-4",l),id:"form-repair",children:[e.jsx(F,{control:s.control,name:"complaint_id",form:s,label:"Kode Pengaduan",data:f,description:"Silakan pilih barang dari daftar."}),e.jsx(F,{control:s.control,name:"item_id",form:s,label:"Pilih Barang",data:o,description:"Silakan pilih barang dari daftar."}),e.jsxs("div",{className:"space-y-2 w-full",children:[e.jsxs("div",{className:"flex items-center gap-x-1",children:[e.jsx(g,{children:"Pilih Lokasi di Peta"}),e.jsx("span",{className:"text-sm font-medium",children:"atau"}),e.jsx("button",{type:"button",className:"text-sm font-medium text-blue-500 underline",onClick:()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(t=>{const{latitude:m,longitude:u}=t.coords;s.setValue("latitude",m),s.setValue("longitude",u),x({lat:m,lng:u}),h.success("Lokasi berhasil diambil!"),console.log(m,u)},t=>{h.error("Tidak dapat mengambil lokasi: "+t.message)}):h.error("Geolocation tidak didukung di browser ini.")},children:"Gunakan Lokasi saat ini"})]}),e.jsx(W,{onCoordinatesChange:d,currentLocation:C})]}),e.jsx(N,{control:s.control,name:"latitude",render:({field:t})=>e.jsxs(w,{children:[e.jsxs(g,{children:["Latitude",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(D,{children:e.jsx(y,{placeholder:"Masukkan Latitude",...t,className:"focus-visible:ring-[#063b3e]"})}),e.jsx(k,{})]})}),e.jsx(N,{control:s.control,name:"longitude",render:({field:t})=>e.jsxs(w,{children:[e.jsxs(g,{children:["Longitude",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(D,{children:e.jsx(y,{placeholder:"Masukkan Longitude",...t,type:"text",className:"focus-visible:ring-[#063b3e]"})}),e.jsx(k,{})]})})]})})}function oe({children:l,loadMore:r,hasMore:o}){const s=i.useRef(null);return i.useEffect(()=>{if(!s.current||!o)return;const c=new IntersectionObserver(d=>{d[0].isIntersecting&&r()},{threshold:1});return c.observe(s.current),()=>c.disconnect()},[r,o]),e.jsxs(O,{children:[e.jsx(H,{placeholder:"Cari item...",className:"h-9 focus-visible:ring-0 focus-visible:border-0"}),e.jsxs(K,{className:"min-w-full",children:[e.jsx(q,{children:"No framework found."}),e.jsx(A,{children:l}),o&&e.jsx("div",{ref:s,className:"h-10"})]})]})}const F=({control:l,name:r,label:o,data:s,form:c,description:d})=>{const[C,x]=i.useState(!1),[j,f]=i.useState(s.slice(0,20)),[t,m]=i.useState(s.length>20),[u,S]=i.useState(!1);i.useEffect(()=>{const a=()=>{S(window.innerWidth<=768)};return a(),window.addEventListener("resize",a),()=>window.removeEventListener("resize",a)},[]);const L=()=>{const a=j.length,p=s.slice(a,a+20);f(n=>[...n,...p]),m(a+p.length<s.length)},P=a=>{x(a),a||(f(s.slice(0,20)),m(s.length>20))};return e.jsx(N,{control:l,name:r,render:({field:a})=>{var p;return e.jsxs(w,{className:"flex flex-col",children:[e.jsx(g,{children:o}),e.jsxs(T,{open:C,onOpenChange:P,modal:u,children:[e.jsx(z,{asChild:!0,children:e.jsx(D,{children:e.jsxs(v,{variant:"outline",role:"combobox",className:b("w-full justify-between",!a.value&&"text-muted-foreground"),children:[a.value?(p=s.find(n=>n.id===a.value))==null?void 0:p.name:"Pilih",e.jsx(ae,{className:"opacity-50"})]})})}),e.jsx(_,{className:b("w-full p-0 z-[9999] popover-content-width-same-as-its-trigger",u??"inset-0 bg-white overflow-auto"),children:e.jsx(oe,{loadMore:L,hasMore:t,children:j.map(n=>e.jsxs(G,{value:n.name,onSelect:()=>{c.setValue(r,n.id),x(!1)},children:[n.name,e.jsx(te,{className:b("ml-auto",n.id===a.value?"opacity-100":"opacity-0")})]},n.id))})})]}),d&&e.jsx(R,{children:d}),e.jsx(k,{})]})}})};export{Se as default};
